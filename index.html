<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test IA Open Source</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;}
#msgs{border:1px solid #002D58;padding:10px;height:300px;overflow-y:auto;background:#f9f9f9;}
.user{color:white;background:#002D58;padding:5px 10px;border-radius:5px;margin:5px 0;align-self:flex-end;}
.ai{color:#333;background:#eee;padding:5px 10px;border-radius:5px;margin:5px 0;align-self:flex-start;}
#input-container{margin-top:10px;display:flex;gap:5px;}
</style>
</head>
<body>

<h3>Test IA Open Source</h3>

<div id="msgs" style="display:flex; flex-direction:column;"></div>

<div id="input-container">
<input type="text" id="input" placeholder="tu vas bien ?" style="flex:1;">
<button id="send">Envoyer</button>
</div>

<script>
const msgs = document.getElementById("msgs");
const input = document.getElementById("input");
const send = document.getElementById("send");

function addMessage(text, cls){
  const d = document.createElement("div");
  d.className = cls;
  d.textContent = text;
  msgs.appendChild(d);
  msgs.scrollTo({ top: msgs.scrollHeight, behavior: "smooth" });
}

send.onclick = async () => {
  const val = input.value.trim();
  if(!val) return;
  addMessage(val, "user");
  input.value = "";
  addMessage("L'IA réfléchit...", "ai");

  try {
    const res = await fetch("/api/chat", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message: val})
    });
    const data = await res.json();
    // enlève le loader
    msgs.lastChild.textContent = data.text;
  } catch(err){
    msgs.lastChild.textContent = "Erreur de connexion : " + err.message;
  }
};
</script>

</body>
</html>
